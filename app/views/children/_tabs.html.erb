<div class="history-card">
  <% @events.where('extract(year from start_date) = ?', year).order(:start_date).reverse.each do |event| %>
    <div class='event w-100'>
      <div class="d-flex justify-content-between border-bottom mb-1">
        <p><%= event.start_date.strftime("%B %d, %Y") %></p>
        <h2 class='mt-3'> <%= event.occasion.capitalize %> </h2>
        <div class="pseudo-image">
          <% if event.photos.attached?  %>
          <%= render 'add_photos_form', event: event%>
          <% end %>
        </div>
      </div>
      <div class='d-flex mt-3'>
        <div class="d-flex link-card">
          <% if event.start_date > Time.now %>
            <% if event.gift.present? && event.activity.present? %>
              <%= render './activity_components/activity_imgcard', activity: event.activity %>
              <%= render './gift_components/gift_imgcard', gift: event.gift %>
            <% elsif event.activity.present? %>
              <%= link_to "Get a gift for #{@child.first_name}", child_path(@child, event_id: event.id, tab: 'gifts'), class: "cards" %>
              <%= render './activity_components/activity_imgcard', activity: event.activity %>
            <% elsif event.gift.present? %>
              <%= link_to "Plan an activity for #{@child.first_name}", child_path(@child, event_id: event.id, tab: 'activities'), class: "cards" %>
              <%= render './gift_components/gift_imgcard', gift: event.gift %>
            <% else %>
              <%= link_to "Get a gift for #{@child.first_name}", child_path(@child, event_id: event.id, tab: 'gifts'), class: "cards" %>
              <%= link_to "Plan an activity for #{@child.first_name}", child_path(@child, event_id: event.id, tab: 'activities'), class: "cards" %>
            <% end %>
          <% end %>
        </div>
        <div class='w-100 overflow-hidden'>
          <% if event.photos.attached? %>
            <div class="owl-carousel owl-theme align-self-center">
              <% event.photos.each do |photo| %>
                <%= cl_image_tag photo.key, width: '250', height: '250', object_fit: "cover"%>
              <% end %>
            </div>
          <% else %>
            <div class="upload-location">
              <%= simple_form_for event, namespace: "event-#{event.id}" do |f| %>
                <%= f.input :photos, as: :file, input_html: { multiple: true, class: 'd-none',
                onChange: 'this.form.submit()' },
                label_html: { class: 'upload-photo'}, label: 'ðŸ“· Upload'  %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>
